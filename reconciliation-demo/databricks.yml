# Databricks Asset Bundle Configuration
# Configuration for the reconciliation demo project

bundle:
  name: reconciliation-demo
  
# Workspace configuration
workspace:
  host: https://your-workspace.cloud.databricks.com
  
# Environments
environments:
  development:
    workspace:
      host: https://dev-workspace.cloud.databricks.com
      root_path: /Workspace/Users/${workspace.current_user.userName}/reconciliation-demo
    
  staging:
    workspace:
      host: https://staging-workspace.cloud.databricks.com
      root_path: /Workspace/Shared/reconciliation-demo-staging
      
  production:
    workspace:
      host: https://prod-workspace.cloud.databricks.com
      root_path: /Workspace/Shared/reconciliation-demo-prod

# Resources
resources:
  pipelines:
    reconciliation_gold_pipeline:
      name: reconciliation-demo-gold-${bundle.environment}
      target: reconciliation_demo_${bundle.environment}
      libraries:
        - file:
            path: ./src/workload_validation/dlt.gold.py
      configuration:
        spark.sql.adaptive.enabled: "true"
        spark.sql.adaptive.coalescePartitions.enabled: "true"
        spark.databricks.delta.optimizeWrite.enabled: "true"
        spark.databricks.delta.autoCompact.enabled: "true"
      development: true
      photon: true
      continuous: false
      
  jobs:
    reconciliation_validation_job:
      name: reconciliation-validation-${bundle.environment}
      job_clusters:
        - job_cluster_key: validation_cluster
          new_cluster:
            spark_version: "13.3.x-scala2.12"
            node_type_id: "i3.xlarge"
            num_workers: 2
            spark_conf:
              "spark.databricks.delta.preview.enabled": "true"
      tasks:
        - task_key: data_validation
          job_cluster_key: validation_cluster
          python_wheel_task:
            package_name: workload_validation
            entry_point: run_validation
          libraries:
            - pypi:
                package: delta-spark==2.4.0

# Include/exclude patterns
include:
  - "src/**"
  - "resources/**"

exclude:
  - "**/__pycache__/**"
  - "**/.pytest_cache/**"
  - "**/.*"